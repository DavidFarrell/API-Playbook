<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.70">
<link rel="alternate" type="application/rss+xml" href="/API-Playbook/blog/rss.xml" title="Hackney API Playbook Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/API-Playbook/blog/atom.xml" title="Hackney API Playbook Blog Atom Feed"><title data-react-helmet="true">Generating Tokens | Hackney API Playbook</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Generating Tokens | Hackney API Playbook"><meta data-react-helmet="true" name="description" content="Generating Tokens"><meta data-react-helmet="true" property="og:description" content="Generating Tokens"><meta data-react-helmet="true" property="og:url" content="https://lbhackney-it.github.io/API-Playbook/API-Playbook/generating_tokens"><link data-react-helmet="true" rel="shortcut icon" href="/API-Playbook/img/favicon.png"><link data-react-helmet="true" rel="canonical" href="https://lbhackney-it.github.io/API-Playbook/API-Playbook/generating_tokens"><link rel="stylesheet" href="/API-Playbook/styles.ed6e5456.css">
<link rel="stylesheet" href="/API-Playbook/main.4988b536.css">
<link rel="preload" href="/API-Playbook/styles.ba3365c1.js" as="script">
<link rel="preload" href="/API-Playbook/runtime~main.38316bdf.js" as="script">
<link rel="preload" href="/API-Playbook/main.3d3f9bef.js" as="script">
<link rel="preload" href="/API-Playbook/1.6926aeac.js" as="script">
<link rel="preload" href="/API-Playbook/2.d37bb84e.js" as="script">
<link rel="preload" href="/API-Playbook/50.035f9e8d.js" as="script">
<link rel="preload" href="/API-Playbook/935f2afb.123a0f62.js" as="script">
<link rel="preload" href="/API-Playbook/17896441.d8b2f932.js" as="script">
<link rel="preload" href="/API-Playbook/a50d4ecb.6e38bca9.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<nav aria-label="Skip navigation links"><button type="button" tabindex="0" class="skipToContent_11B0">Skip to main content</button></nav><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/API-Playbook/"><img src="/API-Playbook/img/logo-long.svg" alt="API Playbook" class="themedImage_YANc themedImage--light_3CMI navbar__logo"><img src="/API-Playbook/img/logo-long.svg" alt="API Playbook" class="themedImage_YANc themedImage--dark_3ARp navbar__logo"><strong class="navbar__title">API Playbook</strong></a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/LBHackney-IT/API-Playbook" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_2N3Q"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_3NWk">🌜</span></div><div class="react-toggle-track-x"><span class="toggle_3NWk">🌞</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/API-Playbook/"><img src="/API-Playbook/img/logo-long.svg" alt="API Playbook" class="themedImage_YANc themedImage--light_3CMI navbar__logo"><img src="/API-Playbook/img/logo-long.svg" alt="API Playbook" class="themedImage_YANc themedImage--dark_3ARp navbar__logo"><strong class="navbar__title">API Playbook</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a href="https://github.com/LBHackney-IT/API-Playbook" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_vMrn"><div class="docSidebarContainer_3Ak5" role="complementary"><div class="sidebar_3gvy"><div class="menu menu--responsive thin-scrollbar menu_1yIk"><button aria-label="Open Menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_1CUI" width="24" height="24" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Release Notes</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/notes">Notes</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Home</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/">Introduction</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/api_standards">API Standards</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/platform_api_vs_service_api">Platform API vs Service API</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/documentation">API Documentation</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Development Process</a><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="0">Designing your API</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/api_design_principles">API Design Principles</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/api_implementation_guidelines">API Implementation Guidelines</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/error_codes">Error Codes</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/naming_conventions">Naming Conventions</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="0">API Practices and Tools</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/linting">Linting</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/static_code_analysis">Static Code Analysis</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="0">DevOps Practices</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/branching_strategy">Branching Strategy</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/deployment_pipeline">Deployment Pipeline</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/infrastructure">Infrastucture as Code</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="0">How to build an API</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/preferred_tech_stack">Preferred Tech Stack</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/api_boilerplate">API Boilerplate - Base API</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/clean_architecture">Clean Architecture</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/serverless_lambda">Serverless Lambda Framework</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/entity_framework">Entity Framework</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="0">Testing</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/tdd">Good TDD Principles</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/unit_test">Writing Unit Tests</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/integration_tests">How to write integration tests</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="0">Deploying your API</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/aws_ecs">AWS / ECS with Fargate and when to use</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/lambda_best_practices">Lambda Functions Use and Good Practice</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/multiple_docker_containers">Composing Your Application With Multiple Docker Containers</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="0">Monitoring</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/alerting">Alerting</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/application_logging">Application Logging Guidelines</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/centralised_logging">Centralised Logging and Monitoring</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/performance_monitoring">Performance Monitoring</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/uptime_monitoring">Uptime Monitoring</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Request Tracing</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/x_ray">X Ray</a></li></ul></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!" tabindex="0">Securing your API</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/API-Playbook/api_keys">API Keys</a></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!" tabindex="0">Lambda authoriser</a><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/API-Playbook/generating_tokens">Generating Tokens</a></li></ul></li></ul></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Other Useful Information</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/rds_access">Access to RDS in a private subnet from local machine</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/ec2_access">Access to EC2 in a private subnet from local machine</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/postgresql">Creating users in PostgreSQL</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Data Migration</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/data_migration">Setting Up DMS</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/pipeline_implementation">Pipeline Implementation</a></li></ul></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">End to End Training</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/first_end_point">Create your first End Point</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Developer API Hub</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/developer_hub">Developer API Hub</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Contact Us</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/contact_us">Contact The Hackney API Team</a></li></ul></li></ul></div></div></div><main class="docMainContainer_2iGs"><div class="container padding-vert--lg docItemWrapper_1bxp"><div class="row"><div class="col docItemCol_U38p"><div class="docItemContainer_a7m4"><article><header><h1 class="docTitle_Oumm">Generating Tokens</h1></header><div class="markdown"><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="generating-tokens"></a>Generating Tokens<a class="hash-link" href="#generating-tokens" title="Direct link to heading">#</a></h2><p><strong> What is a Lambda authorizer? </strong></p><p>  AWS documentation:</p><p><a href="https://docs.aws.amazon.com/apigateway/latest/developerguide/apigateway-use-lambda-authorizer.html" target="_blank" rel="noopener noreferrer">https://docs.aws.amazon.com/apigateway/latest/developerguide/apigateway-use-lambda-authorizer.html</a></p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="custom-implementation-of-a-lambda-authorizer"></a>Custom implementation of a Lambda authorizer<a class="hash-link" href="#custom-implementation-of-a-lambda-authorizer" title="Direct link to heading">#</a></h2><p>For a Lambda authorizer, we use a  custom Lambda function that has been developed in-house. Repository:</p><p><a href="https://github.com/LBHackney-IT/api-auth-token-generator" target="_blank" rel="noopener noreferrer">https://github.com/LBHackney-IT/api-auth-token-generator</a></p><p>It allows for granular access control per API endpoint per environment. To gain access to a given API endpoint, the consuming service will need to supply an authorization token as part of the request, passed in the HTTP header “Authorisation”.</p><p><strong> In the first iteration of this solution, the following applies: </strong></p><ul><li>Tokens are issued per service</li><li>Tokens do not expire</li></ul><p>Each time a consumer makes an API request and supplies the JWT auth token, our custom Lambda function takes the token, validates and decrypts it, retrieves data about the token from the database and compares the data from the database to the API request information.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="when-is-a-token-valid"></a>When is a token valid<a class="hash-link" href="#when-is-a-token-valid" title="Direct link to heading">#</a></h2><ol><li>If the “Enabled” flag is set to true</li><li>This means that the token has not been revoked</li><li>If a token has an expiry date, it should not be a past date</li><li>The environment recorded in the database should match the one from the request</li><li>The API name should match the one from the request</li><li>he HTTP method (GET/POST/etc) should match the one from the request</li></ol><p><strong> NB: The Lambda authorizer approach described above is a new solution and not all APIs have been updated to use it. </strong></p><p>Lambda authorizer documentation:</p><p><a href="https://docs.google.com/document/d/1mpTY-sfYwR2brIF_8KjxiYzW6zgkjbv4Pi-9Y5LRlBA/edit#" target="_blank" rel="noopener noreferrer">https://docs.google.com/document/d/1mpTY-sfYwR2brIF_8KjxiYzW6zgkjbv4Pi-9Y5LRlBA/edit#</a></p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="when-to-use"></a>When to use?<a class="hash-link" href="#when-to-use" title="Direct link to heading">#</a></h2><ul><li><p>HackIT’s custom Lambda authorizer should be used for all new APIs that are to be created. It has been created in a generic way, making it possible to be used across multiple APIs.</p></li><li><p>The only configuration required would be to insert the lookup values into the lookup tables (API name, API endpoint).</p></li><li><p>The above is to be automated as part of our API Hub upcoming work.</p></li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="google-groups-based-authorization"></a>Google Groups based authorization<a class="hash-link" href="#google-groups-based-authorization" title="Direct link to heading">#</a></h2><p>In addition to the custom build lambda authorizer mentioned above, we have also implemented Google groups based authorization in some of our projects.
When developing APIs for internal use, the most convenient way to authenticate users is to use Google SSO. Once the user/client has been authenticated, authorization can be handled at the API level to ensure the user/client has access to the requested resource.
Sample implementation with serverless and .NET Core can be found here:</p><p><a href="https://github.com/LBHackney-IT/comino-printing" target="_blank" rel="noopener noreferrer">https://github.com/LBHackney-IT/comino-printing</a>
In the above solution, each Lambda function that is deployed to API gateway has the authorizer set to the custom API authorizer.</p><p>Each time a request is made to one of the end points in question, the authorizer will take the provided JWT token and check what Google Groups the client is in. If the client is authenticated and is in one of the allowed groups, the request is authorized. Otherwise access is denied. In both cases the standard AWS IAM policy statement is returned indicating whether the request was authorized or not, and then depending on the result either the requested Lambda resource is called or the client gets an unauthorized response.</p><p>Implementing authorization this way requires a bit more development work, but completely takes a way the necessity to manage API keys in the infrastructure. This also gives the business the power to manage their own resources and determine who has access to them.</p></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/LBHackney-IT/API-Playbook/edit/master/docs/generating_tokens.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" role="img" viewBox="0 0 40 40" class="iconEdit_2LL7"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/API-Playbook/api_keys"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">« API Keys</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/API-Playbook/rds_access"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Access to RDS in a private subnet from local machine »</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_2xL- thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#generating-tokens" class="table-of-contents__link">Generating Tokens</a></li><li><a href="#custom-implementation-of-a-lambda-authorizer" class="table-of-contents__link">Custom implementation of a Lambda authorizer</a></li><li><a href="#when-is-a-token-valid" class="table-of-contents__link">When is a token valid</a></li><li><a href="#when-to-use" class="table-of-contents__link">When to use?</a></li><li><a href="#google-groups-based-authorization" class="table-of-contents__link">Google Groups based authorization</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="footer__bottom text--center"><div class="footer__copyright">Made by HackIT.</div></div></div></footer></div>
<script src="/API-Playbook/styles.ba3365c1.js"></script>
<script src="/API-Playbook/runtime~main.38316bdf.js"></script>
<script src="/API-Playbook/main.3d3f9bef.js"></script>
<script src="/API-Playbook/1.6926aeac.js"></script>
<script src="/API-Playbook/2.d37bb84e.js"></script>
<script src="/API-Playbook/50.035f9e8d.js"></script>
<script src="/API-Playbook/935f2afb.123a0f62.js"></script>
<script src="/API-Playbook/17896441.d8b2f932.js"></script>
<script src="/API-Playbook/a50d4ecb.6e38bca9.js"></script>
</body>
</html>