<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.70">
<link rel="alternate" type="application/rss+xml" href="/API-Playbook/blog/rss.xml" title="Hackney API Playbook Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/API-Playbook/blog/atom.xml" title="Hackney API Playbook Blog Atom Feed"><title data-react-helmet="true">Infrastucture as Code | Hackney API Playbook</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Infrastucture as Code | Hackney API Playbook"><meta data-react-helmet="true" name="description" content="HackIT Infrastructure as code"><meta data-react-helmet="true" property="og:description" content="HackIT Infrastructure as code"><meta data-react-helmet="true" property="og:url" content="https://lbhackney-it.github.io/API-Playbook/API-Playbook/infrastructure"><link data-react-helmet="true" rel="shortcut icon" href="/API-Playbook/img/favicon.png"><link data-react-helmet="true" rel="canonical" href="https://lbhackney-it.github.io/API-Playbook/API-Playbook/infrastructure"><link rel="stylesheet" href="/API-Playbook/styles.ed6e5456.css">
<link rel="stylesheet" href="/API-Playbook/main.4a16e2e4.css">
<link rel="preload" href="/API-Playbook/styles.fb3c51b3.js" as="script">
<link rel="preload" href="/API-Playbook/runtime~main.b67196b4.js" as="script">
<link rel="preload" href="/API-Playbook/main.43b0646f.js" as="script">
<link rel="preload" href="/API-Playbook/1.dadddfd9.js" as="script">
<link rel="preload" href="/API-Playbook/2.de67563a.js" as="script">
<link rel="preload" href="/API-Playbook/52.856e34de.js" as="script">
<link rel="preload" href="/API-Playbook/935f2afb.7cd87182.js" as="script">
<link rel="preload" href="/API-Playbook/17896441.efce8ec0.js" as="script">
<link rel="preload" href="/API-Playbook/f1db5c92.c6114346.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<nav aria-label="Skip navigation links"><button type="button" tabindex="0" class="skipToContent_11B0">Skip to main content</button></nav><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/API-Playbook/"><img src="/API-Playbook/img/logo-long.svg" alt="API Playbook" class="themedImage_YANc themedImage--light_3CMI navbar__logo"><img src="/API-Playbook/img/logo-long.svg" alt="API Playbook" class="themedImage_YANc themedImage--dark_3ARp navbar__logo"><strong class="navbar__title">API Playbook</strong></a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/LBHackney-IT/API-Playbook" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_2N3Q"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_3NWk">🌜</span></div><div class="react-toggle-track-x"><span class="toggle_3NWk">🌞</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/API-Playbook/"><img src="/API-Playbook/img/logo-long.svg" alt="API Playbook" class="themedImage_YANc themedImage--light_3CMI navbar__logo"><img src="/API-Playbook/img/logo-long.svg" alt="API Playbook" class="themedImage_YANc themedImage--dark_3ARp navbar__logo"><strong class="navbar__title">API Playbook</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a href="https://github.com/LBHackney-IT/API-Playbook" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_vMrn"><div class="docSidebarContainer_3Ak5" role="complementary"><div class="sidebar_3gvy"><div class="menu menu--responsive thin-scrollbar menu_1yIk"><button aria-label="Open Menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_1CUI" width="24" height="24" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Release Notes</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/notes">Notes</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Home</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/">Introduction</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/api_standards">API Standards</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/platform_api_vs_service_api">Platform API vs Service API</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/documentation">API Documentation</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Development Process</a><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="0">Designing your API</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/api_design_principles">API Design Principles</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/api_implementation_guidelines">API Implementation Guidelines</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/error_codes">Error Codes</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/naming_conventions">Naming Conventions</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="0">API Practices and Tools</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/linting">Linting</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/static_code_analysis">Static Code Analysis</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!" tabindex="0">DevOps Practices</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/API-Playbook/branching_strategy">Branching Strategy</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/API-Playbook/deployment_pipeline">Deployment Pipeline</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/API-Playbook/infrastructure">Infrastucture as Code</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="0">API Setup</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/preferred_tech_stack">Preferred Tech Stack</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/api_boilerplate">API Boilerplate - Base API</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/clean_architecture">Clean Architecture</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/serverless_lambda">Serverless Lambda Framework</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/entity_framework">Entity Framework</a></li></ul></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">How to build an API</a><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Testing</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/tdd">Good TDD Principles</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/unit_test">Setting Up Unit Tests</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/unit_testing">Writing Unit Tests</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/integration_tests">How to write integration tests</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Deploying your API</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/aws_ecs">AWS / ECS with Fargate and when to use</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/lambda_best_practices">Lambda Functions Use and Good Practice</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/multiple_docker_containers">Composing Your Application With Multiple Docker Containers</a></li></ul></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Monitoring</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/alerting">Alerting</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/application_logging">Application Logging Guidelines</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/centralised_logging">Centralised Logging and Monitoring</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/performance_monitoring">Performance Monitoring</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/uptime_monitoring">Uptime Monitoring</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Request Tracing</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/x_ray">X Ray</a></li></ul></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Securing your API</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/api_keys">API Keys</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Lambda authoriser</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/generating_tokens">Generating Tokens</a></li></ul></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Other Useful Information</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/rds_access">Access to RDS in a private subnet from local machine</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/ec2_access">Access to EC2 in a private subnet from local machine</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/postgresql">Creating users in PostgreSQL</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Data Migration</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/data_migration">Setting Up DMS</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/pipeline_implementation">Pipeline Implementation</a></li></ul></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">End to End Training</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/first_end_point">Create your first End Point</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Developer API Hub</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/developer_hub">Developer API Hub</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Contact Us</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/contact_us">Contact The Hackney API Team</a></li></ul></li></ul></div></div></div><main class="docMainContainer_2iGs"><div class="container padding-vert--lg docItemWrapper_1bxp"><div class="row"><div class="col docItemCol_U38p"><div class="docItemContainer_a7m4"><article><header><h1 class="docTitle_Oumm">Infrastucture as Code</h1></header><div class="markdown"><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="hackit-infrastructure-as-code"></a>HackIT Infrastructure as code<a class="hash-link" href="#hackit-infrastructure-as-code" title="Direct link to heading">#</a></h2><p><strong> <u> What is infrastructure as code (IaC)? </u> </strong></p><p>Infrastructure as code is the approach used within HackIT to manage and provision cloud resources with the use of scripted configuration files. It allows for easy maintenance and creation of the different cloud resources for large scale systems in a collaborative manner.</p><p>When using infrastructure-as-code approach, any resources created have their state recorded within state files. Those files will be used by the tool used to manage the infrastructure as a comparison point whenever new resources are added or existing ones are amended.</p><p>IaC is important as it allows for cloud infrastructure to be provisioned in a quick manner and it provides a code reference for the resources created and the configuration used to do so.</p><p>For example, if a resource is accidentally terminated, the IaC can be used to re-provision that machine in exactly the configuration as before. Whereas, with manual provisioning, a developer would need to remember (or consult an external source for) the configuration of the resource, and then take the time to manually reconfigure that within the environment.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="terraform"></a>Terraform<a class="hash-link" href="#terraform" title="Direct link to heading">#</a></h2><p>For more details, please read our HackIT Terraform Guide, containing all details of what Terraform is, how to use it, how we use Terraform and how to use our Terraform templates, including deployment steps:</p><p><a href="https://docs.google.com/document/d/1Wwj0HTBuSPjQ0ym9dtnGc7pM4x4cfA7OsAbr4YVnsWI/edit?usp=sharing" target="_blank" rel="noopener noreferrer">https://docs.google.com/document/d/1Wwj0HTBuSPjQ0ym9dtnGc7pM4x4cfA7OsAbr4YVnsWI/edit?usp=sharing</a></p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="video-tutorial"></a>Video Tutorial<a class="hash-link" href="#video-tutorial" title="Direct link to heading">#</a></h2><p><strong> For a better understanding, you can watch our video on Terraform </strong></p><figure class="video-container"><iframe width="100" src="https://www.youtube.com/embed/sGbjWgSTpnY" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"></iframe></figure><p>We use Terraform as our infrastructure-as-code tool - it is provider agnostic and makes use of HashiCorp Configuration Language (HCL).</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="what-is-a-terraform-state-file"></a>What is a Terraform state file?<a class="hash-link" href="#what-is-a-terraform-state-file" title="Direct link to heading">#</a></h2><p>A Terraform state file stores the state of the infrastructure at the point of you applying it - this is the way Terraform knows what resources were created (via the given Terraform configuration). When an update to a resource has happened, Terraform will detect the difference between the state and the update and will change the resource (if you perform the “apply” action).</p><p>If a new AWS resource is created not via your Terraform file, the state will not be aware of it. This means that resources created via separate Terraform files are independent of each other. If you destroy infrastructure via Terraform, it will not affect any of the other AWS resources not created by your Terraform file and state.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="hackit-terraform-templates"></a>HackIT Terraform templates<a class="hash-link" href="#hackit-terraform-templates" title="Direct link to heading">#</a></h2><p>We have three repositories with terraform templates. We use those for all the AWS resources we have identified are required by more than one service. These templates allow developers to simply provide configuration values for their particular instances, based on existing templates.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="common-layer-infrastructure"></a>Common layer infrastructure<a class="hash-link" href="#common-layer-infrastructure" title="Direct link to heading">#</a></h2><p>The ‘common layer’ is the infrastructure required to be set up for each account as “base” infrastructure, including networking, load balancers, database (Postgres, DocumentDB)  and ECS clusters.</p><p>  GitHub repository:</p><p><a href="https://github.com/LBHackney-IT/aws-hackney-common-terraform" target="_blank" rel="noopener noreferrer">https://github.com/LBHackney-IT/aws-hackney-common-terraform</a></p><p>  Detailed guide on how to use it, including screenshots and step-by-step instructions:</p><p><a href="https://docs.google.com/document/d/1Wwj0HTBuSPjQ0ym9dtnGc7pM4x4cfA7OsAbr4YVnsWI/edit#heading=h.553ntygln9sl" target="_blank" rel="noopener noreferrer">https://docs.google.com/document/d/1Wwj0HTBuSPjQ0ym9dtnGc7pM4x4cfA7OsAbr4YVnsWI/edit#heading=h.553ntygln9sl</a></p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="components-per-service-layer-infrastructure"></a>Components per service layer infrastructure<a class="hash-link" href="#components-per-service-layer-infrastructure" title="Direct link to heading">#</a></h2><p>  The components per service layer is all cloud resources that need to be created for any new Fargate/EC2 hosted API/app that is to be deployed.</p><p>  For example, the template will create an ECS service, ECR repo, load balancer listener, security group and target group from developer supplied input values.. Those resources will be solely used for the API/app that to be deployed. They are independent of other APIs/apps and if they are destroyed or modified, they will not affect resources of any other API/app running.</p><p>  GitHub repository:</p><p><a href="https://github.com/LBHackney-IT/aws-hackney-components-per-service-terraform" target="_blank" rel="noopener noreferrer">https://github.com/LBHackney-IT/aws-hackney-components-per-service-terraform</a></p><p>  Detailed guide on how to use it, including screenshots and step-by-step instructions:</p><p><a href="https://docs.google.com/document/d/1Wwj0HTBuSPjQ0ym9dtnGc7pM4x4cfA7OsAbr4YVnsWI/edit#heading=h.bbczall7icfy" target="_blank" rel="noopener noreferrer">https://docs.google.com/document/d/1Wwj0HTBuSPjQ0ym9dtnGc7pM4x4cfA7OsAbr4YVnsWI/edit#heading=h.bbczall7icfy</a></p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="dms-terraform"></a>DMS Terraform<a class="hash-link" href="#dms-terraform" title="Direct link to heading">#</a></h2><p>DMS is used by many of the platform APIs that require a data migration task and instance to be set up so data can be migrated from on-premise to our cloud environment.</p><p>The template includes set up for both:</p><p>DMS task, when there is an existing DMS instance</p><p>DMS task and instance provisioning (full set up)</p><p>How to use notes, including example usage file can be found here:</p><p><a href="https://github.com/LBHackney-IT/aws-dms-terraform" target="_blank" rel="noopener noreferrer">https://github.com/LBHackney-IT/aws-dms-terraform</a></p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="lambda-apis-deployment"></a>Lambda APIs deployment<a class="hash-link" href="#lambda-apis-deployment" title="Direct link to heading">#</a></h2><p><strong> <u> More on Lambda APIs </u> </strong></p><p>For any APIs that we have chosen Lambda as a serverless deployment option, we use Serverless as a way to provision the necessary resources:</p><ul><li><p>Lambda functions</p></li><li><p>CloudWatch logs</p></li><li><p>IAM roles</p></li><li><p>API Gateway, including usage plan and keys</p></li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="deployment-per-environment-for-apisapps"></a>Deployment per environment for APIs/apps<a class="hash-link" href="#deployment-per-environment-for-apisapps" title="Direct link to heading">#</a></h2><p>Each API/app is to maintain its own infrastructure. This is achieved by adding the Terraform files to the respective API/app repository.</p><p>To support deployment per environment in multiple AWS accounts, the following folder structure has been introduced:</p><p>API/app repo</p><p>terraform</p><p>development</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">- main.tf</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>staging</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">- main.tf</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>production</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">- main.tf</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>  In this way, we have individual Terraform files for each AWS account (environment) we are deploying, ensuring that separate states and configurations are maintained.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="deployment-using-circleci"></a>Deployment using CircleCI<a class="hash-link" href="#deployment-using-circleci" title="Direct link to heading">#</a></h2><p>The existing CircleCI pipeline has been set to generate AWS credentials per environment (account) based on the pipeline workflow step. For each account we deploy to, the pipeline is configured to look at the respective folder path
(e.g. terraform/development/main.tf).</p><p>Each time a deployment occurs, terraform initializes the modules specified within the given main.tf and runs “apply”.</p><p>Note: the terraform apply -auto-approve is a command used to force apply (without being presented a confirmation question), which is required to achieve automation.</p><p>More details can be found here:</p><p><a href="https://docs.google.com/document/d/1Wwj0HTBuSPjQ0ym9dtnGc7pM4x4cfA7OsAbr4YVnsWI/edit#heading=h.1q32ztqxg199" target="_blank" rel="noopener noreferrer">https://docs.google.com/document/d/1Wwj0HTBuSPjQ0ym9dtnGc7pM4x4cfA7OsAbr4YVnsWI/edit#heading=h.1q32ztqxg199</a></p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="how-to-apply-terraform-manually"></a>How to apply Terraform manually<a class="hash-link" href="#how-to-apply-terraform-manually" title="Direct link to heading">#</a></h2><p>  In some cases, we don’t have a pipeline set up to automatically apply the Terraform configuration for us.
In this case, we need to run “apply” manually.</p><p>For example, our individual AWS account network set up is currently applied manually with no pipeline. In comparison, all Terraform resources maintained by the individual APIs/apps are applied using a CI/CD pipeline.</p><p>More information and guide can be found here:</p><p><a href="https://docs.google.com/document/d/1Wwj0HTBuSPjQ0ym9dtnGc7pM4x4cfA7OsAbr4YVnsWI/edit#heading=h.pdxhd5fuwdpm" target="_blank" rel="noopener noreferrer">https://docs.google.com/document/d/1Wwj0HTBuSPjQ0ym9dtnGc7pM4x4cfA7OsAbr4YVnsWI/edit#heading=h.pdxhd5fuwdpm</a></p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="how-to-find-what-has-been-applied-in-our-aws-accounts-non-api-specific-terraform"></a>How to find what has been applied in our AWS accounts (non API specific Terraform)<a class="hash-link" href="#how-to-find-what-has-been-applied-in-our-aws-accounts-non-api-specific-terraform" title="Direct link to heading">#</a></h2><p>The networking set up and other shared resources have been created via our ‘common Terraform’ template repository. Every time someone makes a change a new PR needs to be created against the following repository:</p><p><a href="https://github.com/LBHackney-IT/aws-hackney-common-terraform/tree/master/applied_terraform" target="_blank" rel="noopener noreferrer">https://github.com/LBHackney-IT/aws-hackney-common-terraform/tree/master/applied_terraform</a></p><p>This ensures that although there is a state file, developers will be able to see the configuration files of what has been applied and make changes to it, while being aware of what has previously been provisioned.</p></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/LBHackney-IT/API-Playbook/edit/master/docs/infrastructure.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" role="img" viewBox="0 0 40 40" class="iconEdit_2LL7"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/API-Playbook/deployment_pipeline"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">« Deployment Pipeline</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/API-Playbook/preferred_tech_stack"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Preferred Tech Stack »</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_2xL- thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#hackit-infrastructure-as-code" class="table-of-contents__link">HackIT Infrastructure as code</a></li><li><a href="#terraform" class="table-of-contents__link">Terraform</a></li><li><a href="#video-tutorial" class="table-of-contents__link">Video Tutorial</a></li><li><a href="#what-is-a-terraform-state-file" class="table-of-contents__link">What is a Terraform state file?</a></li><li><a href="#hackit-terraform-templates" class="table-of-contents__link">HackIT Terraform templates</a></li><li><a href="#common-layer-infrastructure" class="table-of-contents__link">Common layer infrastructure</a></li><li><a href="#components-per-service-layer-infrastructure" class="table-of-contents__link">Components per service layer infrastructure</a></li><li><a href="#dms-terraform" class="table-of-contents__link">DMS Terraform</a></li><li><a href="#lambda-apis-deployment" class="table-of-contents__link">Lambda APIs deployment</a></li><li><a href="#deployment-per-environment-for-apisapps" class="table-of-contents__link">Deployment per environment for APIs/apps</a></li><li><a href="#deployment-using-circleci" class="table-of-contents__link">Deployment using CircleCI</a></li><li><a href="#how-to-apply-terraform-manually" class="table-of-contents__link">How to apply Terraform manually</a></li><li><a href="#how-to-find-what-has-been-applied-in-our-aws-accounts-non-api-specific-terraform" class="table-of-contents__link">How to find what has been applied in our AWS accounts (non API specific Terraform)</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="footer__bottom text--center"><div class="footer__copyright">Made by HackIT.</div></div></div></footer></div>
<script src="/API-Playbook/styles.fb3c51b3.js"></script>
<script src="/API-Playbook/runtime~main.b67196b4.js"></script>
<script src="/API-Playbook/main.43b0646f.js"></script>
<script src="/API-Playbook/1.dadddfd9.js"></script>
<script src="/API-Playbook/2.de67563a.js"></script>
<script src="/API-Playbook/52.856e34de.js"></script>
<script src="/API-Playbook/935f2afb.7cd87182.js"></script>
<script src="/API-Playbook/17896441.efce8ec0.js"></script>
<script src="/API-Playbook/f1db5c92.c6114346.js"></script>
</body>
</html>