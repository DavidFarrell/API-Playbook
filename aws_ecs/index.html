<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.70">
<link rel="alternate" type="application/rss+xml" href="/API-Playbook/blog/rss.xml" title="Hackney API Playbook Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/API-Playbook/blog/atom.xml" title="Hackney API Playbook Blog Atom Feed"><title data-react-helmet="true">AWS / ECS with Fargate and when to use | Hackney API Playbook</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="AWS / ECS with Fargate and when to use | Hackney API Playbook"><meta data-react-helmet="true" name="description" content="ECS/Fargate"><meta data-react-helmet="true" property="og:description" content="ECS/Fargate"><meta data-react-helmet="true" property="og:url" content="https://lbhackney-it.github.io/API-Playbook/API-Playbook/aws_ecs"><link data-react-helmet="true" rel="shortcut icon" href="/API-Playbook/img/favicon.png"><link data-react-helmet="true" rel="canonical" href="https://lbhackney-it.github.io/API-Playbook/API-Playbook/aws_ecs"><link rel="stylesheet" href="/API-Playbook/styles.ed6e5456.css">
<link rel="stylesheet" href="/API-Playbook/main.87fd6f3d.css">
<link rel="preload" href="/API-Playbook/styles.ba3365c1.js" as="script">
<link rel="preload" href="/API-Playbook/runtime~main.8bb3e3c5.js" as="script">
<link rel="preload" href="/API-Playbook/main.15f1206c.js" as="script">
<link rel="preload" href="/API-Playbook/1.8c76eab2.js" as="script">
<link rel="preload" href="/API-Playbook/2.1e944c1b.js" as="script">
<link rel="preload" href="/API-Playbook/47.58199a0d.js" as="script">
<link rel="preload" href="/API-Playbook/935f2afb.0942da18.js" as="script">
<link rel="preload" href="/API-Playbook/17896441.2190863f.js" as="script">
<link rel="preload" href="/API-Playbook/e11d71b7.10574900.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<nav aria-label="Skip navigation links"><button type="button" tabindex="0" class="skipToContent_11B0">Skip to main content</button></nav><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/API-Playbook/"><img src="/API-Playbook/img/logo-long.svg" alt="API Playbook" class="themedImage_YANc themedImage--light_3CMI navbar__logo"><img src="/API-Playbook/img/logo-long.svg" alt="API Playbook" class="themedImage_YANc themedImage--dark_3ARp navbar__logo"><strong class="navbar__title">API Playbook</strong></a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/LBHackney-IT/API-Playbook" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_2N3Q"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_3NWk">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_3NWk">ðŸŒž</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/API-Playbook/"><img src="/API-Playbook/img/logo-long.svg" alt="API Playbook" class="themedImage_YANc themedImage--light_3CMI navbar__logo"><img src="/API-Playbook/img/logo-long.svg" alt="API Playbook" class="themedImage_YANc themedImage--dark_3ARp navbar__logo"><strong class="navbar__title">API Playbook</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a href="https://github.com/LBHackney-IT/API-Playbook" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_vMrn"><div class="docSidebarContainer_3Ak5" role="complementary"><div class="sidebar_3gvy"><div class="menu menu--responsive thin-scrollbar menu_1yIk"><button aria-label="Open Menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_1CUI" width="24" height="24" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Release Notes</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/notes">Notes</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Home</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/">Introduction</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/api_standards">API Standards</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/platform_api_vs_service_api">Platform API vs Service API</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/documentation">API Documentation</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Development Process</a><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="0">Designing your API</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/api_design_principles">API Design Principles</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/api_implementation_guidelines">API Implementation Guidelines</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/error_codes">Error Codes</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/naming_conventions">Naming Conventions</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="0">API Practices and Tools</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/linting">Linting</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/static_code_analysis">Static Code Analysis</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="0">DevOps Practices</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/branching_strategy">Branching Strategy</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/deployment_pipeline">Deployment Pipeline</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/infrastructure">Infrastucture as Code</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="0">How to build an API</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/preferred_tech_stack">Preferred Tech Stack</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/api_boilerplate">API Boilerplate - Base API</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/clean_architecture">Clean Architecture</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Testing</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/tdd">Good TDD Principles</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/unit_test">Writing Unit Tests</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/integration_tests">How to write integration tests</a></li></ul></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/serverless_lambda">Serverless Lambda Framework</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!" tabindex="0">Deploying your API</a><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/API-Playbook/aws_ecs">AWS / ECS with Fargate and when to use</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/API-Playbook/lambda_best_practices">Lambda Functions Use and Good Practice</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/API-Playbook/multiple_docker_containers">Composing Your Application With Multiple Docker Containers</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="0">Monitoring</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/alerting">Alerting</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/application_logging">Application Logging Guidelines</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/centralised_logging">Centralised Logging and Monitoring</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/performance_monitoring">Performance Monitoring</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/uptime_monitoring">Uptime Monitoring</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Request Tracing</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/x_ray">X Ray</a></li></ul></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="0">Securing your API</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/api_keys">API Keys</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Lambda authoriser</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/generating_tokens">Generating Tokens</a></li></ul></li></ul></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Other Useful Information</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/rds_access">Access to RDS in a private subnet from local machine</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/ec2_access">Access to EC2 in a private subnet from local machine</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/postgresql">Creating users in PostgreSQL</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Data Migration</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/data_migration">Setting Up DMS</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/pipeline_implementation">Pipeline Implementation</a></li></ul></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Contact Us</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/API-Playbook/contact_us">Contact The Hackney API Team</a></li></ul></li></ul></div></div></div><main class="docMainContainer_2iGs"><div class="container padding-vert--lg docItemWrapper_1bxp"><div class="row"><div class="col docItemCol_U38p"><div class="docItemContainer_a7m4"><article><header><h1 class="docTitle_Oumm">AWS / ECS with Fargate and when to use</h1></header><div class="markdown"><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="ecsfargate"></a>ECS/Fargate<a class="hash-link" href="#ecsfargate" title="Direct link to heading">#</a></h2><p>All new Hackney APIs developed usinguse AWS Lambda as a serverless way of hosting APIs.</p><p>There are APIs, developed before we adopted the serverless approach, which use ECS with Fargate or EC2 as a hosting option.</p><p><strong> What is Fargate? </strong></p><p>Fargate is an AWS service that works with AWS ECS and AWS Kubernetes. It is a severless way to manage containers, without the need to manage and provision servers.</p><p>More information:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">        https://aws.amazon.com/fargate/</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p><strong> When to use Fargate? </strong></p><p>Lambda is to be used with all new APIs, with the exception of a few scenarios.</p><p>The use cases below outline the scenarios, when ECS with Fargate should be chosen as a way to host an API, instead of Lambda.</p><p><strong> Large request or response payload </strong></p><p>Lambda has the following request/response payload limitations:</p><p>6 MB (synchronous) / 256 KB (asynchronous)</p><p>More details here:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">        https://docs.aws.amazon.com/lambda/latest/dg/gettingstarted-limits.html</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>In certain scenarios, an API might be required to take as an input a large object (e.g. a file) or need to return a large object.</p><p>Fargate should be used in the above scenario as Lambda would not be suitable for this type of APIs.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="possible-work-around"></a>Possible work-around<a class="hash-link" href="#possible-work-around" title="Direct link to heading">#</a></h2><ol><li>Even if a request/response payload is large, we can still use Lambda by inserting the request/response object into S3 and accept/return a link to the file in S3.only take as an input / return as an output an S3 link for retrieving the file.</li></ol><p><strong> Long running function </strong></p><p>We aim to develop APIs that are fast and reliable. This means that we typically expect an API response to be delivered in a matter of seconds.
However, in some scenarios, we might need to execute a long running job (e.g. batch operation). In this case, Lambda will not be suitable as it has a 15 min timeout. ECS with Fargate should be used instead.</p><p><strong> Large number of requests </strong>
If an API is expected to receive a large number of requests (millions per month) and that those requests might be frequent and happening any day of the week and any time of the day, then Fargate might prove as a more cost-effective solution, as Lambda is billed per invocations.</p><p><strong> Storing large files during run time </strong>
Lambda has the limitation of a memory range from 128 to 3008 MB.</p><p>This means that if any large file needs to be stored at run time to be accessed later on in the function, Lambda might not be the best a possible solution., in which case Fargate should be used, as we have  Fargate allows us control over the memory allocation for containers.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="how-to-create-an-app--api-with-ecsfargate-hosting-setup"></a>How to create an app / API with ECS/Fargate hosting setup?<a class="hash-link" href="#how-to-create-an-app--api-with-ecsfargate-hosting-setup" title="Direct link to heading">#</a></h2><p>It is recommended that you use Terraform to provision AWS resources. We already have produced a terraform template that generates all necessary resources for an API/app that is to be hosted using ECS with Fargate.</p><p>In this playbook, please refer to the Terraform section to find out more about the templates and how to use them. The template has configuration both for front end apps and for back end services that are to use ECS with Fargate.</p><p><strong> The Terraform template creates the following resources: </strong></p><p><strong>  <u> Common layer Fargate  </u> </strong></p><p>  a. ECR repository</p><p>  b. Fargate service</p><p>  c. Security group</p><p><strong> <u> Back end layer </u> </strong></p><p>  a. API Gateway</p><p>b. Target group</p><p>c. Network load-balancer listener</p><p><strong> <u> Front end layer </u> </strong></p><p> a. Application load balancer rule</p><p> b. Target group</p><p><strong> Step-by-step how to use guide for the terraform template: </strong></p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">    https://docs.google.com/document/d/1Wwj0HTBuSPjQ0ym9dtnGc7pM4x4cfA7OsAbr4YVnsWI/edit#heading=h.bbczall7icfy</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/LBHackney-IT/API-Playbook/edit/master/docs/aws_ecs.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" role="img" viewBox="0 0 40 40" class="iconEdit_2LL7"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/API-Playbook/serverless_lambda"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« Serverless Lambda Framework</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/API-Playbook/lambda_best_practices"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Lambda Functions Use and Good Practice Â»</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_2xL- thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#ecsfargate" class="table-of-contents__link">ECS/Fargate</a></li><li><a href="#possible-work-around" class="table-of-contents__link">Possible work-around</a></li><li><a href="#how-to-create-an-app--api-with-ecsfargate-hosting-setup" class="table-of-contents__link">How to create an app / API with ECS/Fargate hosting setup?</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="footer__bottom text--center"><div class="footer__copyright">Made by HackIT.</div></div></div></footer></div>
<script src="/API-Playbook/styles.ba3365c1.js"></script>
<script src="/API-Playbook/runtime~main.8bb3e3c5.js"></script>
<script src="/API-Playbook/main.15f1206c.js"></script>
<script src="/API-Playbook/1.8c76eab2.js"></script>
<script src="/API-Playbook/2.1e944c1b.js"></script>
<script src="/API-Playbook/47.58199a0d.js"></script>
<script src="/API-Playbook/935f2afb.0942da18.js"></script>
<script src="/API-Playbook/17896441.2190863f.js"></script>
<script src="/API-Playbook/e11d71b7.10574900.js"></script>
</body>
</html>